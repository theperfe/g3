

	<!DOCTYPE html>
	<meta charset="utf-8">
	<head>

	<style>

	.link {
	  stroke: #999;
	}

	</style>


	<!--<script type="text/javascript" src="d3.v2.js"></script>-->
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="../scripts/jquery.min.js"></script>

	</head>

	<body>
		<div id="viz"></div>
<!--		<form id="save_data">
			<input type="submit" id="save" value="Save the graph"/>
		</form>
-->
		<button id="save_data"> Save the graph </button>
		<script type="text/javascript">

	//Trying to read and write data from a file on the server. I am able to read from the file on the server, and also able to write into a file on the server using the get method, but only for small amounts of data. Will try post method in 31.html.


			var width = 900;
			var height = 500;
			var color = d3.scale.category20();

//			var nodes = [{label:"e",group:1},{label:"e",group:2,},];	//just some two nodes to start with
//			var links = [{"source":0, "target":1}];	//just an edge to start with

			var nodes=[], links=[];
			var count = 0; //to know whether the mouse click was on the source node or on the target node while creating edges.
			var source, target; //source and target nodes while creating edges using mouse clicks.

			var force = d3.layout.force()
					.size([width,height])
					.charge(-60)
					.linkDistance(30);

			var svg = d3.select("#viz")
				.append("svg")
				.attr("width",width)
				.attr("height", height)
				.style("border", "2px solid black")

			d3.json("../json/miserables.json", function(error, graph)
			{

					force.nodes(graph.nodes)
					.links(graph.links)
					.start()
					.on("tick", tick);

//					console.log(force.nodes());

	
					svg.on("mousedown", svg_mousedown);

			   var node = svg.selectAll(".node");
			   var link = svg.selectAll(".link");

			nodes = force.nodes(),
			    links = force.links();



			function svg_mousedown()
			{
				var point = d3.mouse(this),
					node_item = {x:point[0],y:point[1],label:"e",group:Math.round(Math.random()*10)};
					nodes.push(node_item);
	//				console.log("entered");
					restart();
			}

			function node_mousedown(d,i)
			{

					console.log("entered");
				if(count == 1)
				{
	//				console.log("entered");
					target = i;
					if (source !== target){
						links.push({"source":source, "target":target});
						count = 0;
						restart();
					}
				}
				else if (count == 0)
				{
	//				console.log("entered");
					source = i;
					count = 1;
				}

			}
				

			function tick() {
				link.attr("x1", function(d) { return d.source.x; })
				    .attr("y1", function(d) { return d.source.y; })
				    .attr("x2", function(d) { return d.target.x; })
				    .attr("y2", function(d) { return d.target.y; });

				node.attr("cx", function(d) { return d.x; })
				    .attr("cy", function(d) { return d.y; });
			}

			function restart()
			{

				link = link.data(links);

				link.enter().insert("line",".node")
				.attr("class", "link");

				node = node.data(nodes);

				node.enter().append("circle")
				.attr("class", "node")
				.attr("r", 5)
				.attr("fill", function(d){ return color(d.group);})
				.on("mousedown", node_mousedown)
				.call(force.drag);

//				node.append("title")
//				.text(function(d) {return d.label});

				force.start();
//				console.log(svg.selectAll(".node"));

			}


			restart();

			});

			$(document).ready(function(){
				$("button").click(function(){
					nodes_string = JSON.stringify(nodes);					
//					links_string = JSON.stringify(links);
					window.location.href="../php/1.php?nodes="+nodes_string;
					return false;
				});
			});

	</script>


